language: scala

jdk:
  - oraclejdk8

sudo: false

deploy:
  provider: releases
  api_key:
    secure: Rar9MWXI7am8+5hOWSuqgzQxHxZzuPKQf5NYnob9Kd+1KzCWPz6cZfi8Sjo0sqtnBGMecS/lvNHDxAwLkTj4useXzETPIywTcEhWq4ywvteiaEPn00Nf+PYNm5IgSTOZtYuz9CZdnLhMlmHrwITWhtugJbVRwbxKk4SPV4E+Synx4qMNSkN/SspVxEvfsFOzoxV4e5wPajxRsfi5y5KIZxLta7cMtYbtaPtISez1+miD9Ro6hTHf2n8wj18Xea3O41Q/k9ZyZbr97ryjYljoBtVINsx+hFVew7NPhqeNmRqTDR0BcWsPGP7IlSnnYeTum/rYrKlbW2hzM+DyfbDW3UqfTThcrnSxtz6/6wie7ZvXVCWtZNgCElcwPuEMc9vt8rDyIW/igHYlLtM2VVrz4i0zVtYugEYkVcCUYMuzg5ZaKPvKYT76fZ5ju0ffA1gg6FArxnKw6Ygk31HwX0uzP4GQm81kvqSGTljMy2JV5H/W6hRZUoLQBwOovAZKR/W8jCj4pgDul7Z0O8JUpIbmmQfu4HFyqceza7564tDbEOybwyUnDkKjS0/zBJjamhCtEEAxivdVAbt0Hd2Qh7Xpk+FgWr5Ottfv1qUjNJkmQe0uyUgLSQ+zqA4owyzz6+HaHNMsP3yZA7hkyTC9o3RDpRn9U4pymnuhDBRu5MJz0js=
  file: /home/travis/build/codejam1024/shadowsocksr-android/shadowsocksr-release.apk
  skip_cleanup: true
  on:
    tags: true

addons:
    apt:
        packages:
            - gcc-multilib
            - g++-multilib
            - libstdc++6:i386
            - libgcc1:i386
            - zlib1g:i386
            - libncurses5:i386

scala:
    - 2.11.8

before_cache:
    - find $HOME/.sbt -name "*.lock" | xargs rm
    - find $HOME/.ivy2 -name "*.lock" | xargs rm

cache:
    directories:
        - $HOME/.ivy2
        - $HOME/.sbt

android:
    components:
        - tools
        - build-tools-25.0.2
        - extra-android-m2repository
        - extra-google-m2repository

install:
    - ./travis-ci/setup.sh
    - export NDK_CCACHE=ccache
    - export ARCH=`uname -m`
    - export ANDROID_NDK_HOME=$HOME/.android/android-ndk-r12b
    - export ANDROID_HOME=$HOME/.android/android-sdk-linux
    - export PATH=${ANDROID_NDK_HOME}:${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools:${PATH}
    - cp local.properties.travis local.properties

script:
    - sbt native-build android:package-release
